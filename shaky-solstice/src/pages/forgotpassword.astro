---
import '../styles/global.css';
---
<!DOCTYPE html>
<html lang="id" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lupa Password - Sistem Pariwisata</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body class="h-full">
    <!-- Dark Mode Toggle -->
    <div class="fixed top-4 left-4 z-50">
        <button 
            id="theme-toggle"
            class="btn-secondary p-3 rounded-full shadow-lg hover:shadow-xl transition-all duration-300"
            title="Toggle Dark Mode"
        >
            <i id="theme-icon" class="fas fa-moon text-lg"></i>
        </button>
    </div>

    <div class="min-h-full flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
        <div class="max-w-md w-full space-y-8">
            <!-- Header -->
            <div class="text-center">
                <div class="mx-auto w-20 h-20 bg-gradient-to-r from-blue-600 to-emerald-600 rounded-full flex items-center justify-center shadow-lg">
                    <i class="fas fa-key text-white text-2xl"></i>
                </div>
                <h2 class="mt-6 text-3xl font-bold text-blue-900 dark:text-blue-200">
                    Lupa Password?
                </h2>
                <p class="mt-2 text-sm text-blue-700 dark:text-blue-200">
                    Masukkan email Anda untuk reset password
                </p>
            </div>

            <!-- Reset Password Form -->
            <form id="reset-form" class="mt-8 space-y-6">
                <div class="card">
                    <div class="space-y-6">
                        <!-- Email Field -->
                        <div class="relative">
                            <label for="email" class="login-label">
                                Email Administrator
                            </label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <i class="fas fa-envelope icon-primary"></i>
                                </div>
                                <input 
                                    id="email" 
                                    name="email" 
                                    type="email" 
                                    required 
                                    class="login-input"
                                    placeholder="admin@gmail.com"
                                >
                            </div>
                            <p class="mt-2 text-xs text-gray-600 dark:text-gray-400">
                                Link reset password akan dikirim ke email ini
                            </p>
                        </div>

                        <!-- Reset Button -->
                        <button 
                            type="submit" 
                            id="reset-btn"
                            class="group relative w-full btn-primary py-3 text-base shadow-lg hover:shadow-xl transform hover:scale-[1.02] transition-all duration-300"
                        >
                            <span class="absolute left-0 inset-y-0 flex items-center pl-3">
                                <i class="fas fa-paper-plane text-white opacity-75 group-hover:opacity-100 transition-opacity"></i>
                            </span>
                            Kirim Link Reset Password
                        </button>

                        <!-- Alternative Actions -->
                        <div class="flex flex-col space-y-3 pt-4 border-t border-gray-200 dark:border-gray-600">
                            <a 
                                href="/login" 
                                class="text-center text-sm text-blue-600 hover:text-blue-500 dark:text-blue-400 dark:hover:text-blue-300 transition-colors flex items-center justify-center gap-2"
                            >
                                <i class="fas fa-sign-in-alt"></i>
                                Kembali ke Login
                            </a>
                            
                            <div class="text-center">
                                <p class="text-xs text-gray-500 dark:text-gray-400 mb-2">
                                    Tidak menerima email?
                                </p>
                                <button 
                                    type="button"
                                    id="resend-btn"
                                    class="text-sm text-emerald-600 hover:text-emerald-500 dark:text-emerald-400 dark:hover:text-emerald-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                                    disabled
                                >
                                    Kirim Ulang (<span id="countdown">60</span>s)
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>

            <!-- Additional Info -->
             <div class="text-center">
                <div class="bg-blue-50 dark:bg-gray-800 border border-blue-200 dark:border-gray-600 rounded-lg p-4 mb-4">
                    <div class="flex items-center justify-center mb-2">
                        <i class="fas fa-info-circle text-blue-600 dark:text-blue-400 mr-2"></i>
                        <h3 class="text-sm font-medium text-blue-800 dark:text-blue-300">Informasi Reset Password</h3>
                    </div>
                    <p class="text-xs text-blue-700 dark:text-gray-300">
                        Link reset akan berlaku selama 15 menit. Periksa folder spam jika tidak menerima email.
                    </p>
                </div>
                
                <p class="text-xs text-gray-500 dark:text-gray-300">
                    Sistem Manajemen Pariwisata <br>
                </p>
                <div class="mt-4 flex justify-center space-x-4 text-gray-400 dark:text-gray-400">
                    <i class="fas fa-globe-asia" title="Platform Global"></i>
                    <i class="fas fa-map-pin" title="Lokasi Terpercaya"></i>
                    <i class="fas fa-shield-alt" title="Keamanan Terjamin"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Background Decorative Elements -->
    <div class="fixed inset-0 -z-10 overflow-hidden">
        <div class="absolute -top-40 -right-32 w-96 h-96 bg-gradient-to-br from-blue-400/20 to-emerald-400/20 rounded-full blur-3xl dark:from-blue-600/10 dark:to-emerald-600/10"></div>
        <div class="absolute -bottom-40 -left-32 w-96 h-96 bg-gradient-to-tr from-emerald-400/20 to-blue-400/20 rounded-full blur-3xl dark:from-emerald-600/10 dark:to-blue-600/10"></div>
    </div>

    <script>
        let countdownTimer: ReturnType<typeof setInterval>;
        let countdownSeconds = 60;

        // Dark mode functionality
        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            const html = document.documentElement;
            const themeIcon = document.getElementById('theme-icon');
            
            if (html && themeIcon) {
                if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                    html.classList.add('dark');
                    themeIcon.className = 'fas fa-sun text-lg';
                } else {
                    html.classList.remove('dark');
                    themeIcon.className = 'fas fa-moon text-lg';
                }
            }
        }

        function toggleDarkMode() {
            const html = document.documentElement;
            const themeIcon = document.getElementById('theme-icon');
            
            if (html && themeIcon) {
                const isDark = html.classList.contains('dark');
                
                if (isDark) {
                    html.classList.remove('dark');
                    themeIcon.className = 'fas fa-moon text-lg';
                    localStorage.setItem('theme', 'light');
                } else {
                    html.classList.add('dark');
                    themeIcon.className = 'fas fa-sun text-lg';
                    localStorage.setItem('theme', 'dark');
                }
            }
        }

        function showNotification(message: string, notificationType: 'success' | 'error' | 'info') {
            if (typeof message !== 'string') return;
            if (typeof notificationType !== 'string') return;
            
            const notification = document.createElement('div');
            const isSuccess = notificationType === 'success';
            
            notification.className = 'fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transform transition-all duration-300 translate-x-full ' + 
                (isSuccess ? 'notification-success' : 'notification-error');
            
            notification.innerHTML = 
                '<div class="flex items-center space-x-2">' +
                    '<i class="fas ' + (isSuccess ? 'fa-check-circle' : 'fa-exclamation-circle') + '"></i>' +
                    '<span>' + message + '</span>' +
                '</div>';
            
            document.body.appendChild(notification);
            
            setTimeout(function() {
                if (notification.style) {
                    notification.style.transform = 'translateX(0)';
                }
            }, 100);
            
            setTimeout(function() {
                if (notification.style) {
                    notification.style.transform = 'translateX(100%)';
                }
                setTimeout(function() {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        function startCountdown() {
            const resendBtn = document.getElementById('resend-btn');
            const countdownEl = document.getElementById('countdown');
            
            if (!countdownEl) return;
            if (!(resendBtn instanceof HTMLButtonElement)) return;
            
            resendBtn.disabled = true;
            countdownSeconds = 60;
            
            countdownTimer = setInterval(function() {
                countdownSeconds--;
                countdownEl.textContent = countdownSeconds.toString();
                
                if (countdownSeconds <= 0) {
                    clearInterval(countdownTimer);
                    resendBtn.disabled = false;
                    resendBtn.innerHTML = 'Kirim Ulang';
                }
            }, 1000);
        }

        function handleReset(event: Event) {
            if (!event || typeof event.preventDefault !== 'function') return;
            event.preventDefault();
            
            const emailElement = document.getElementById('email');
            
            if (!emailElement || !(emailElement instanceof HTMLInputElement)) return;
            
            const email = emailElement.value;
            
            if (!email) {
                showNotification('Mohon masukkan email Anda!', 'error');
                return;
            }
            
            // Email validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showNotification('Format email tidak valid!', 'error');
                return;
            }
            
            const button = document.getElementById('reset-btn');
            if (!button || !(button instanceof HTMLButtonElement)) return;
            
            const originalText = button.innerHTML;
            
            button.innerHTML = 
                '<span class="absolute left-0 inset-y-0 flex items-center pl-3">' +
                    '<i class="fas fa-spinner fa-spin text-white opacity-75"></i>' +
                '</span>' +
                'Mengirim Email...';
            button.disabled = true;
            
            setTimeout(function() {
                showNotification('Link reset password telah dikirim ke email Anda!', 'success');
                startCountdown();
                
                button.innerHTML = originalText;
                button.disabled = false;
            }, 2000);
        }

        function handleResend() {
            const emailElement = document.getElementById('email');
            
            if (!emailElement || !(emailElement instanceof HTMLInputElement)) return;
            
            const email = emailElement.value;
            
            if (!email) {
                showNotification('Mohon masukkan email terlebih dahulu!', 'error');
                return;
            }
            
            showNotification('Email reset password telah dikirim ulang!', 'success');
            startCountdown();
        }

        // Page load animations
        function initAnimations() {
            const elements = document.querySelectorAll('.space-y-8 > div');
            elements.forEach(function(element, index) {
                if (!(element instanceof HTMLElement)) return;
                
                const elementStyle = element.style;
                if (elementStyle) {
                    elementStyle.opacity = '0';
                    elementStyle.transform = 'translateY(20px)';
                    
                    setTimeout(function() {
                        elementStyle.transition = 'all 0.6s ease-out';
                        elementStyle.opacity = '1';
                        elementStyle.transform = 'translateY(0)';
                    }, index * 200);
                }
            });
        }

        // Input validation
        function initValidation() {
            const emailInput = document.getElementById('email');
            if (!(emailInput instanceof HTMLInputElement)) return;
            
            emailInput.addEventListener('blur', function(event) {
                const target = event.target;
                if (!(target instanceof HTMLInputElement)) return;
                
                const classList = target.classList;
                if (!classList) return;
                
                if (!target.value) {
                    classList.add('border-red-300', 'focus:ring-red-500');
                    classList.remove('border-gray-300', 'focus:ring-blue-500');
                } else {
                    classList.remove('border-red-300', 'focus:ring-red-500');
                    classList.add('border-gray-300', 'focus:ring-blue-500');
                }
            });
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            initializeTheme();
            initAnimations();
            initValidation();
            
            // Theme toggle
            const themeToggle = document.getElementById('theme-toggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', toggleDarkMode);
            }
            
            // Form submit
            const resetForm = document.getElementById('reset-form');
            if (resetForm) {
                resetForm.addEventListener('submit', handleReset);
            }
            
            // Resend button
            const resendBtn = document.getElementById('resend-btn');
            if (resendBtn) {
                resendBtn.addEventListener('click', handleResend);
            }
        });
    </script>
</body>
</html>